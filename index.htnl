<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alerta Pessoal - Seguranﾃｧa Individual</title>
    
    <!-- Configuraﾃｧﾃｵes para Web App -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Alerta">
    <meta name="theme-color" content="#ff4d4d">
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='48' fill='%23ff4d4d'/><path d='M50 25 L35 35 V55 C35 65 50 75 50 75 C50 75 65 65 65 55 V35 L50 25Z' fill='white'/><text x='50' y='57' font-family='Arial' font-size='18' fill='%23ff4d4d' text-anchor='middle' font-weight='bold'>!</text></svg>">

    <style>
        :root {
            --vermelho-alarme: #ff4d4d;
            --azul-camera: #3498db;
            --verde-localizacao: #2ecc71;
            --cor-fundo: #f4f7f6;
            --cor-texto: #333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--cor-fundo);
            color: var(--cor-texto);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 10px 0 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .logo-container {
            width: 80px;
            height: 80px;
            background-color: var(--vermelho-alarme);
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .logo-svg {
            width: 50px;
            height: 50px;
            fill: white;
        }

        h1 {
            font-size: 1.8rem;
            color: #2c3e50;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 20px;
            max-width: 500px;
            margin: 0 auto;
            width: 100%;
        }

        .btn-grande {
            border: none;
            border-radius: 20px;
            padding: 40px 20px;
            font-size: 1.4rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: transform 0.1s, filter 0.2s;
            text-decoration: none;
            text-align: center;
        }

        .btn-grande:active { transform: scale(0.95); filter: brightness(0.9); }

        .btn-alarme { background-color: var(--vermelho-alarme); }
        .btn-camera { background-color: var(--azul-camera); }
        .btn-localizacao { background-color: var(--verde-localizacao); }

        .btn-alterar-apoio {
            background-color: #7f8c8d;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
            max-width: 500px;
            align-self: center;
        }

        .icon { font-size: 2.5rem; }

        #videoPreview {
            width: 100%;
            max-width: 400px;
            border-radius: 15px;
            display: none;
            margin: 10px auto;
            background: #000;
        }

        #modal-config {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
        }

        .modal-content input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .btn-salvar {
            width: 100%;
            padding: 12px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        footer {
            text-align: center;
            font-size: 0.9rem;
            color: #7f8c8d;
            padding: 20px 0;
            line-height: 1.5;
        }

        .recording {
            animation: pulse 1.5s infinite;
            background-color: #e74c3c !important;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>

    <header>
        <div class="logo-container">
            <svg class="logo-svg" viewBox="0 0 100 100">
                <path d="M50 15 L25 30 V55 C25 70 50 85 50 85 C50 85 75 70 75 55 V30 L50 15Z" />
                <rect x="46" y="35" width="8" height="20" fill="#ff4d4d" rx="2"/>
                <circle cx="50" cy="62" r="5" fill="#ff4d4d"/>
            </svg>
        </div>
        <h1>Alerta Pessoal</h1>
    </header>

    <div class="container">
        <!-- Botﾃ｣o Alarme -->
        <button class="btn-grande btn-alarme" onclick="toggleAlarme()" id="btnAlarme">
            <span class="icon">圷</span>
            <span>ATIVAR ALARME</span>
        </button>

        <!-- Botﾃ｣o Cﾃ｢mera -->
        <video id="videoPreview" autoplay muted playsinline></video>
        <button class="btn-grande btn-camera" onclick="toggleCamera()" id="btnCamera">
            <span class="icon">萄</span>
            <span id="txtCamera">GRAVAR Vﾃ好EO</span>
        </button>

        <!-- Botﾃ｣o Localizaﾃｧﾃ｣o -->
        <button class="btn-grande btn-localizacao" onclick="enviarLocalizacao()">
            <span class="icon">桃</span>
            <span>ENVIAR LOCALIZAﾃﾃグ</span>
        </button>

        <button class="btn-alterar-apoio" onclick="abrirConfig(true)">ALTERAR APOIO</button>
    </div>

    <footer>
        IMPORTANTE: Este site ﾃｩ uma ferramenta auxiliar. <br>
        Em emergﾃｪncias, ligue para o 190.
    </footer>

    <!-- Modal -->
    <div id="modal-config">
        <div class="modal-content">
            <h2 id="tituloModal">Configuraﾃｧﾃ｣o Inicial</h2>
            <p>Escolha quem receberﾃ｡ seu alerta.</p>
            <input type="text" id="nomeContato" placeholder="Nome do contato">
            <input type="tel" id="telContato" placeholder="DDD + Telefone (Ex: 11999999999)">
            <button class="btn-salvar" id="btnSalvarModal" onclick="salvarConfig()">SALVAR</button>
        </div>
    </div>

    <script>
        let alarmeSonoro = null;
        let mediaRecorder;
        let cameraStream = null;
        let isGravandoVideo = false;
        let videoChunks = [];

        window.onload = function() {
            if (!localStorage.getItem('contatoEmergencia')) {
                abrirConfig(false);
            }
        };

        function abrirConfig(isAlterar) {
            const modal = document.getElementById('modal-config');
            if (isAlterar) {
                document.getElementById('tituloModal').innerText = "Alterar Apoio";
                document.getElementById('btnSalvarModal').innerText = "ALTERAR";
                const contato = JSON.parse(localStorage.getItem('contatoEmergencia'));
                if (contato) {
                    document.getElementById('nomeContato').value = contato.nome;
                    document.getElementById('telContato').value = contato.tel;
                }
            }
            modal.style.display = 'flex';
        }

        function salvarConfig() {
            const nome = document.getElementById('nomeContato').value;
            const tel = document.getElementById('telContato').value;
            if (nome && tel) {
                localStorage.setItem('contatoEmergencia', JSON.stringify({ nome, tel }));
                document.getElementById('modal-config').style.display = 'none';
                alert('Contato salvo!');
            } else {
                alert('Preencha os campos.');
            }
        }

        function enviarLocalizacao() {
            const contatoStr = localStorage.getItem('contatoEmergencia');
            if (!contatoStr) {
                alert("Por favor, configure um contato de apoio primeiro.");
                abrirConfig(false);
                return;
            }

            const contato = JSON.parse(contatoStr);

            if (navigator.geolocation) {
                alert("Obtendo sua localizaﾃｧﾃ｣o precisa... Aguarde.");
                
                navigator.geolocation.getCurrentPosition(position => {
                    const lat = position.coords.latitude;
                    const long = position.coords.longitude;
                    const googleMapsLink = `https://www.google.com/maps?q=${lat},${long}`;
                    const mensagem = `Socorro! Estou em perigo. Minha localizaﾃｧﾃ｣o: ${googleMapsLink}`;
                    const smsUrl = `sms:${contato.tel}?body=${encodeURIComponent(mensagem)}`;
                    
                    window.location.href = smsUrl;

                }, error => {
                    alert("Erro ao obter localizaﾃｧﾃ｣o. Verifique o GPS.");
                }, {
                    enableHighAccuracy: true,
                    timeout: 10000
                });
            } else {
                alert("Navegador nﾃ｣o suporta geolocalizaﾃｧﾃ｣o.");
            }
        }

        function toggleAlarme() {
            const btn = document.getElementById('btnAlarme');
            if (!alarmeSonoro) {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                const lfo = audioCtx.createOscillator();
                oscillator.type = 'square'; oscillator.frequency.value = 150;
                lfo.type = 'square'; lfo.frequency.value = 6;
                lfo.connect(gainNode.gain); oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.start(); lfo.start();
                alarmeSonoro = { oscillator, lfo, audioCtx };
                btn.querySelector('span:last-child').innerText = "PARAR ALARME";
                btn.style.filter = "brightness(1.5)";
            } else {
                alarmeSonoro.oscillator.stop(); alarmeSonoro.lfo.stop();
                alarmeSonoro = null;
                btn.querySelector('span:last-child').innerText = "ATIVAR ALARME";
                btn.style.filter = "brightness(1)";
            }
        }

        async function toggleCamera() {
            const btn = document.getElementById('btnCamera');
            const txt = document.getElementById('txtCamera');
            const videoPreview = document.getElementById('videoPreview');

            if (!isGravandoVideo) {
                try {
                    cameraStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }, audio: true });
                    videoPreview.srcObject = cameraStream;
                    videoPreview.style.display = 'block';
                    mediaRecorder = new MediaRecorder(cameraStream);
                    videoChunks = [];
                    mediaRecorder.ondataavailable = e => videoChunks.push(e.data);
                    mediaRecorder.onstop = () => {
                        const blob = new Blob(videoChunks, { type: 'video/webm' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'emergencia.webm';
                        a.click();
                        cameraStream.getTracks().forEach(t => t.stop());
                        videoPreview.style.display = 'none';
                    };
                    mediaRecorder.start();
                    isGravandoVideo = true;
                    btn.classList.add('recording');
                    txt.innerText = "PARAR GRAVAﾃﾃグ";
                } catch (err) { alert("Erro na cﾃ｢mera: " + err); }
            } else {
                mediaRecorder.stop();
                isGravandoVideo = false;
                btn.classList.remove('recording');
                txt.innerText = "GRAVAR Vﾃ好EO";
            }
        }
    </script>
</body>
</html>
